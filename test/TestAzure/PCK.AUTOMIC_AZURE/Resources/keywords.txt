*** Settings ***
Resource          variables.txt

*** Keywords ***
Connect AE
    Action Connect    ${_AE_HOST}    ${_AE_PORT}    ${_AE_USER}    ${_AE_PASS}    ${_AE_TEMP_FOLD}

Set Overwrite Agent
    Run Keyword If    '${ENV}' == 'WIN'    Set Overwrite Agent WIN
    Run Keyword If    '${ENV}' == 'UNIX'    Set Overwrite Agent UNIX
    Run Keyword If    '${ENV}' == 'QTP'    Set Overwrite Agent QTP

Set Overwrite Agent WIN
    Action Set    &AGENT#    ${_PROMPTSET_AGENT_WIN}
    Action Set    &LOGIN#    ${_PROMPTSET_LOGIN_WIN}

Set Overwrite Agent UNIX
    Action Set    &AGENT#    ${_PROMPTSET_AGENT_UNIX}
    Action Set    &LOGIN#    ${_PROMPTSET_LOGIN_UNIX}

Set Overwrite Agent QTP
    Action Set    &AGENT#    ${_PROMPTSET_AGENT_QTP}
    Action Set    &LOGIN#    ${_PROMPTSET_LOGIN_QTP}

Action Report Should Contain
    [Arguments]    ${text}
    ${report} =    Action Get Report
    Should Contain    ${report}    ${text}

Action Report Should Be Found
    ${report} =    Action Get Report
    Should Not Be Empty    ${report}

Action Report Should Not Be Found
    ${report} =    Action Get Report
    Should Be Empty    ${report}

Action Return Code Should Be
    [Arguments]    ${code}
    ${returnCode}=    Action Get Variable    Return code
    Should Be Equal    ${returnCode}    ${code}

Action Return Code Should Not Equal
    [Arguments]    ${code}
    ${returnCode}=    Action Get Variable    Return code
    Should Not Be Equal    ${returnCode}    ${code}

Action Return Status Should Be
    [Arguments]    ${status}
    ${returnStatus}=    Action Get Variable    Status
    Should Be Equal    ${returnStatus}    ${status}

Action Object Variable File Path Should Be
    [Arguments]    ${Variable_Name}    ${File_name}
    ${File_path}=    Action Get Variable    ${Variable_Name}
    Should End With    ${File_path}    ${File_name}
    Set Global Variable    ${File_path}

Action Object Variable Count Value Should Be
    [Arguments]    ${Variable_Name}
    ${Count_Value}=    Action Get Variable    ${Variable_Name}
    Should Be True    ${Count_Value} >= 0

Action Object Variable Should Be Found
    [Arguments]    ${Object_Variable}
    ${objectVariable}=    Action Get Variable    ${Object_Variable}
    Should Not Be Empty    ${objectVariable}
    Set Global Variable    ${objectVariable}

Action Object Variable Should Not Be Found
    [Arguments]    ${Object_Variable}
    ${objectVariable}=    Action Get Variable    ${Object_Variable}
    Should Be Empty    ${objectVariable}

Assert Success
    Action Report Should Be Found
    Action Return Status Should Be    ${ENDED_OK}
    Action Return Code Should Be    ${RETURN_CODE_SUCCESS}

Assert Failure
    Action Report Should Be Found
    Action Return Status Should Be    ${ENDED_NOT_OK}
    Action Return Code Should Be    ${RETURN_CODE_FAILURE}

Assert Mandatory
    Action Report Should Not Be Found

Delete File
    Action Create    ${_DELETE_FILE_ACTION}
    Action Set    &UC4RB_DIR_FILE_RM_NAME#    ${File_path}
    Action Set    &UC4RB_DIR_FILE_RM_FAIL#    Yes
    Set Overwrite Agent
    Action Execute

Genarate String
    ${Generated_Name}    Generate Random String    8    [LOWER]
    Set Global Variable    ${Generated_Name}

Configure Connection
    [Arguments]    ${Subscription_ID}    ${Keystore_Path}    ${Keystore_Password}
    Action Set    &UC4RB_AZR_SUBSCRIPTION_ID#    ${Subscription_ID}
    Action Set    &UC4RB_AZR_KEYSTORE_PATH#    ${Keystore_Path}
    Action Set    &UC4RB_AZR_KEYSTORE_PSWD#    ${Keystore_Password}

Change VM State
    [Arguments]    ${_CHANGE_VM_STATE_ACTION}    ${Subscription_ID}    ${Keystore_Path}    ${Keystore_Password}    ${Name_VM}    ${Name_Cloud_Service}
    ...    ${Name_Deployment}    ${Command}
    Action Create    ${_CHANGE_VM_STATE_ACTION}
    Configure Connection    ${Subscription_ID}    ${Path_Keystore}    ${Password_Keystore}
    Action Set    &UC4RB_AZR_VM_NAME#    ${VM_Name}
    Action Set    &UC4RB_AZR_CLOUD_SERVICE#    ${Cloud_Service_Name}
    Action Set    &UC4RB_AZR_DEPLOYMENT#    ${Deployment_Name}
    Action Set    &UC4RB_AZR_COMMAND#    ${Command}
    Set Overwrite Agent
    Action Execute
    ${Generated_ID}=    Action Get Variable    &UC4RB_AZR_REQUEST_ID#
    Set Global Variable    ${Generated_ID}

Storage Account Info
    [Arguments]    ${Account_Name}    ${Access_Key}
    Action Set    &UC4RB_AZR_STORAGE_ACCOUNT_NAME#    ${Account_Name}
    Action Set    &UC4RB_AZR_STORAGE_ACCESS_KEY#    ${Access_Key}

Create Storage Container
    [Arguments]    ${_CREATE_STORAGE_ACTION}    ${Account_Name}    ${Access_Key}    ${Container_Name}    ${Access_Type}
    Action Create    ${_CREATE_STORAGE_ACTION}
    Storage Account Info    ${Name_Account}    ${Key_Access}
    Action Set    &UC4RB_AZR_CONTAINER_NAME#    ${Container_Name}
    Action Set    &UC4RB_AZR_CONTAINER_ACCESS#    ${Access_Type}
    Set Overwrite Agent
    Action Execute
    ${Generated_Container_Name}=    Action Get Variable    &UC4RB_AZR_CONTAINER_NAME#
    Set Global Variable    ${Generated_Container_Name}

Delete Storage Container
    [Arguments]    ${_DELETE_STORAGE_CONTAINER_ACTION}    ${Account_Name}    ${Access_Key}    ${Container_Name}    ${Lease_ID}
    Action Create    ${_DELETE_STORAGE_CONTAINER_ACTION}
    Storage Account Info    ${Name_Account}    ${Key_Access}
    Action Set    &UC4RB_AZR_CONTAINER_NAME#    ${Container_Name}
    Action Set    &UC4RB_AZR_LEASE_ID#    ${EMPTY}
    Set Overwrite Agent
    Action Execute

Create VM
    [Arguments]    ${_CREATE_VM_ACTION}    ${Subscription_ID}    ${Keystore_Path}    ${Keystore_Password}    ${Name_Cloud_Service}    ${VM_Configuration_File}
    Action Create    ${_CREATE_VM_ACTION}
    Configure Connection    ${Subscription_ID}    ${Path_Keystore}    ${Password_Keystore}
    Action Set    &UC4RB_AZR_CLOUD_SERVICE#    ${Cloud_Service_Name}
    Action Set    &UC4RB_AZR_FILE_PATH#    ${Create_VM_FilePath}
    Set Overwrite Agent
    Action Execute
    ${Generated_ID}=    Action Get Variable    &UC4RB_AZR_REQUEST_ID#
    Set Global Variable    ${Generated_ID}

Delete VM
    [Arguments]    ${_DELETE_VM_ACTION}    ${Subscription_ID}    ${Keystore_Path}    ${Keystore_Password}    ${Name_VM}    ${Name_Cloud_Service}
    ...    ${Name_Deployment}    ${Delete_Attached_Media}
    Action Create    ${_DELETE_VM_ACTION}
    Configure Connection    ${Subscription_ID}    ${Path_Keystore}    ${Password_Keystore}
    Action Set    &UC4RB_AZR_VM_NAME#    ${VM_Name}
    Action Set    &UC4RB_AZR_CLOUD_SERVICE#    ${Cloud_Service_Name}
    Action Set    &UC4RB_AZR_DEPLOYMENT#    ${Deployment_Name}
    Action Set    &UC4RB_AZR_VM_MEDIA#    YES
    Set Overwrite Agent
    Action Execute

Put Blob
    [Arguments]    ${_PUT_BLOB_ACTION}    ${Account_Name}    ${Access_Key}    ${Container_Name}    ${Blob_Name}    ${File_To_Upload}
    ...    ${Content_Type}
    Action Create    ${_PUT_BLOB_ACTION}
    Storage Account Info    ${Name_Account}    ${Key_Access}
    Action Set    &UC4RB_AZR_CONTAINER_NAME#    ${Container_Name}
    Action Set    &UC4RB_AZR_BLOB_NAME#    ${Blob_Name}
    Action Set    &UC4RB_AZR_BLOB_FILE#    ${File_To_Upload}
    Action Set    &UC4RB_AZR_BLOB_CONTENT_TYPE#    ${Content_Type}
    Set Overwrite Agent
    Action Execute
    ${Generated_Blob_Name}=    Action Get Variable    &UC4RB_AZR_BLOB_NAME#
    Set Global Variable    ${Generated_Blob_Name}

Create Cloud Service
    [Arguments]    ${_CREATE_CLOUD_SERVICE_ACTION}    ${Subscription_ID}    ${Keystore_Path}    ${Keystore_Password}    ${Parameter_File}
    Action Create    ${_CREATE_CLOUD_SERVICE_ACTION}
    Configure Connection    ${Subscription_ID}    ${Path_Keystore}    ${Password_Keystore}
    Action Set    &UC4RB_AZR_CS_CONFIG_FILE#    ${Parameter_File}
    Set Overwrite Agent
    Action Execute

Delete Cloud Service
    [Arguments]    ${_DELETE_CLOUD_SERVICE_ACTION}    ${Subscription_ID}    ${Keystore_Path}    ${Keystore_Password}    ${Name_Cloud_Service}    ${Delete_Attached_Media}
    Action Create    ${_DELETE_CLOUD_SERVICE_ACTION}
    Configure Connection    ${Subscription_ID}    ${Path_Keystore}    ${Password_Keystore}
    Action Set    &UC4RB_AZR_CLOUD_SERVICE#    ${Name_Cloud_Service}
    Action Set    &UC4RB_AZR_DELETE_MEDIA#    ${Delete_Attached_Media}
    Set Overwrite Agent
    Action Execute
